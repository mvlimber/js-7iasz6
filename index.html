<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />


  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com//firebasejs/8.2.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-storage.js"></script>

  <script>
    var firebaseConfig = {
        apiKey: "AIzaSyDVT644vSE0ue8KyDy-o9YwbYPX3m0ZmSc",
        authDomain: "slimmeeigendomdb.firebaseapp.com",
        projectId: "slimmeeigendomdb",
        storageBucket: "slimmeeigendomdb.appspot.com",
        messagingSenderId: "636221237434",
        appId: "1:636221237434:web:3db507acbf4a6a1e0d7a83",
        measurementId: "G-2JL08QYJJ3"
      };
      firebase.initializeApp(firebaseConfig);
      var firestore=firebase.firestore();
      var fileStorageRef =firebase.storage().ref();
  </script>
  <style>
    .content {
      max-width: 500px;
      margin: auto;
    }
  </style>
</head>
<div class="content">

  <body>
    <center>
      <h6>Welcome to MyCondos</h6>
      <br>
      <h6>Please login to access all information on your properties</h6>
      <ul id="objectForm"> </ul>
      <div class="row">
        <form class="col s12" target="_top">
          <div class="row">
            <div class="input-field col s12">
              <input id="email" type="email" maxlength="50" class="validate" required aria-required="true">
              <label for="email">Email</label>
              <span class="helper-text" data-error="please enter valid email" ></span>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s12">
              <input id="password" type="password" class="validate" required aria-required="true">
              <label for="password">Password</label>
            </div>
          </div>
        </form>

      </div>

      <button class="btn waves-effect waves-light" type="submit" onclick="action()">Log in<i class="material-icons right">perm_identity</i></button>
      <br><br>
      <a href="www.vub.be">
        <font color='blue'>Forgot password? First time user?</font>
      </a>
    </center>


    <script>
      
      function validateEntries() {
        var valid= true;
        if (!document.getElementById("email").checkValidity()) {
          M.toast({html:"Please enter your email"});
          valid=false;
        };
        if (!document.getElementById("password").checkValidity()) {
          M.toast({html:"Please enter your password"});
          valid=false;
        };
        return valid;
      };

      function onSuccess() {
         window.top.location.href = "www.vub.be";
        //window.location.href = "<?=ScriptApp.getService().getUrl()?>?screen=Application";
      };
      
      function action(){
        if (validateEntries()) {
          var email = document.getElementById("email").value;
          var password = document.getElementById("password").value;

          var docUserRef = firestore.collection("Users").doc(email);
          docUserRef.get().then(function(user){
            if (user.exists)  {
              firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION)
                .then(function() {
                    firebase.auth().signInWithEmailAndPassword(email, password)
                      .then(function(user){onSuccess();
                      })
                      .catch(function(error) {
                        M.toast({html:"Invalid email or password"});
                      });
                })
                .catch (function(error) {
                  M.toast({html:error.message + "...authentication server not accessible"});
                });  
            }
            else {
              M.toast({html:"Unknown email: Please contact your administartor"});
            };
          });

          
        };
      };
    </script>


  </body>
</div>

</html>